# ğŸ“Š VERSION 2.7 - SCHÃ‰MA VISUEL

## ğŸ¯ SYSTÃˆME DE RÃ‰SERVATIONS TEMPORAIRES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WORKFLOW COMPLET v2.7                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ CLIENT CRÃ‰E COMMANDE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  "Jean"    â”‚
   â”‚  Sandwich  â”‚
   â”‚  x3        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ EnregistrÃ© dans: commandes (statut: en_attente)
        â”œâ”€ Articles dans: commande_items
        â””â”€ Stock: PAS TOUCHÃ‰ âœ…


2ï¸âƒ£ CAISSIÃˆRE CLIQUE "ENCAISSER"
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  POST /api/reservations/commande/Jean     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ VÃ©rifie stock rÃ©el via v_stock_disponible
        â”‚  â†’ Stock rÃ©el = stock_disponible - rÃ©servations
        â”‚
        â”œâ”€ Si stock OK:
        â”‚  âœ… CrÃ©e rÃ©servation_temporaire
        â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     â”‚ nom_commande: "Jean"         â”‚
        â”‚     â”‚ article_id: 1 (Sandwich)     â”‚
        â”‚     â”‚ quantite: 3                  â”‚
        â”‚     â”‚ created_at: NOW()            â”‚
        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€ Si stock insuffisant:
           âŒ Erreur 409: "Stock insuffisant"


3ï¸âƒ£ STOCK VISIBLE PARTOUT DIMINUE
   
   Calcul automatique via vue v_stock_disponible:
   
   Stock AffichÃ© = Stock Initial - RÃ©servations
   
   Exemple:
   - Stock initial: 20 sandwichs
   - RÃ©servÃ© par Jean: 3
   - Stock affichÃ©: 17 âœ…
   
   Visible sur:
   âœ… Page Client
   âœ… Page Caisse (autre caissiÃ¨re)
   âœ… Page Admin
   âœ… Page PrÃ©parateur


4ï¸âƒ£ DEUX SCÃ‰NARIOS POSSIBLES

   A) CONFIRMATION PAIEMENT âœ…
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Cliquer "Confirmer Paiement"  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ PUT /api/commandes/:id/payer
           â”‚  â†’ Statut: payee
           â”‚  â†’ TRIGGER dÃ©crÃ©mente stock
           â”‚  â†’ DELETE rÃ©servation_temporaire
           â”‚
           â””â”€ RÃ©sultat:
              â€¢ Commande payÃ©e âœ…
              â€¢ Stock dÃ©crÃ©mentÃ© âœ…
              â€¢ RÃ©servation supprimÃ©e âœ…

   B) ANNULATION âŒ
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Cliquer "Annuler" ou Fermer   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ DELETE /api/reservations/commande/Jean
           â”‚  â†’ Supprime rÃ©servation_temporaire
           â”‚
           â””â”€ RÃ©sultat:
              â€¢ Stock PAS touchÃ© âœ…
              â€¢ RÃ©servation supprimÃ©e âœ…
              â€¢ Stock libÃ©rÃ© immÃ©diatement âœ…


5ï¸âƒ£ CLEANUP AUTOMATIQUE (SÃ©curitÃ©)

   Toutes les 30 minutes:
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  nettoyer_reservations_expirees()   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€ DELETE FROM reservation_temporaire
           WHERE created_at < NOW() - INTERVAL '30 min'
   
   AppelÃ© automatiquement sur:
   â€¢ GET /api/articles
   â€¢ POST /api/reservations/...
```

---

## ğŸ“Š STRUCTURE BASE DE DONNÃ‰ES

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TABLE: articles                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id                   SERIAL PRIMARY KEY                â”‚
â”‚  nom                  VARCHAR(100) UNIQUE               â”‚
â”‚  description          TEXT                              â”‚
â”‚  prix                 DECIMAL(10,2)                     â”‚
â”‚  stock_disponible     INTEGER  â—„â”€â”                      â”‚
â”‚  actif                BOOLEAN     â”‚                     â”‚
â”‚  image_url            VARCHAR(255)â”‚ â—„â”€â”€ URL Unsplash   â”‚
â”‚  created_at           TIMESTAMP   â”‚                     â”‚
â”‚  updated_at           TIMESTAMP   â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLE: reservation_temporaire   â”‚   â”‚    VUE: v_stock_disponible         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id             SERIAL PK        â”‚   â”‚  id                                â”‚
â”‚  nom_commande   VARCHAR(100)     â”‚   â”‚  nom                               â”‚
â”‚  article_id     INTEGER FK  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤  stock_initial                     â”‚
â”‚  quantite       INTEGER          â”‚   â”‚  quantite_reservee  â—„â”€â”€ SUM(rt.qte)â”‚
â”‚  created_at     TIMESTAMP        â”‚   â”‚  stock_reel_disponible             â”‚
â”‚  UNIQUE(nom_commande, article)   â”‚   â”‚    = stock - rÃ©servations âœ¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  image_url                         â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TABLE: commandes                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id                   SERIAL PRIMARY KEY                â”‚
â”‚  nom_commande         VARCHAR(50) UNIQUE                â”‚
â”‚  statut               VARCHAR(25)                       â”‚
â”‚    â†’ 'en_attente' | 'payee' | 'livree' |               â”‚
â”‚      'livree_partiellement' | 'annulee'                 â”‚
â”‚  montant_total        DECIMAL(10,2)                     â”‚
â”‚  montant_cb           DECIMAL(10,2)  â—„â”€â”€ v2.4           â”‚
â”‚  montant_especes      DECIMAL(10,2)  â—„â”€â”€ v2.4           â”‚
â”‚  montant_cheque       DECIMAL(10,2)  â—„â”€â”€ v2.4           â”‚
â”‚  date_paiement        TIMESTAMP                         â”‚
â”‚  date_livraison       TIMESTAMP                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: commande_items      â”‚   â”‚  TRIGGER:               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  decrement_stock        â”‚
â”‚  id           SERIAL PK      â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  commande_id  INTEGER FK     â”‚   â”‚  WHEN statut:           â”‚
â”‚  article_id   INTEGER FK     â”‚   â”‚    en_attente â†’ payee   â”‚
â”‚  quantite     INTEGER        â”‚   â”‚  THEN:                  â”‚
â”‚  prix_unitaire DECIMAL       â”‚   â”‚    UPDATE articles      â”‚
â”‚  est_livre    BOOLEAN â—„â”€v2.6 â”‚   â”‚    SET stock -= qte     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ CALCUL STOCK RÃ‰EL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FORMULE MAGIQUE v2.7 âœ¨                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Stock AffichÃ© = Stock Initial - RÃ©servations Actives      â”‚
â”‚                                                             â”‚
â”‚  Exemple:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Article: Sandwich                              â”‚       â”‚
â”‚  â”‚  Stock en base: 20                              â”‚       â”‚
â”‚  â”‚                                                  â”‚       â”‚
â”‚  â”‚  RÃ©servations actives:                          â”‚       â”‚
â”‚  â”‚    - Commande "Jean": 3 sandwichs               â”‚       â”‚
â”‚  â”‚    - Commande "Marie": 5 sandwichs              â”‚       â”‚
â”‚  â”‚    Total rÃ©servÃ©: 8                             â”‚       â”‚
â”‚  â”‚                                                  â”‚       â”‚
â”‚  â”‚  Stock affichÃ©: 20 - 8 = 12 âœ…                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â”‚  Si autre caissiÃ¨re essaie d'encaisser 15 sandwichs:       â”‚
â”‚  â†’ ERREUR: Stock insuffisant (12 < 15) âŒ                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â±ï¸ TIMELINE EXEMPLE

```
T+0   â”‚ Stock Sandwich: 20
      â”‚ RÃ©servations: []
      â”‚ Stock affichÃ©: 20
      â”‚
      â”‚ ğŸ‘¤ CaissiÃ¨re A: "Encaisser Jean (3)"
      â”œâ”€â–º RÃ©servation crÃ©Ã©e
      â”‚
T+1   â”‚ Stock Sandwich: 20  (pas touchÃ©)
      â”‚ RÃ©servations: [Jean: 3]
      â”‚ Stock affichÃ©: 17  âœ…
      â”‚
      â”‚ ğŸ‘¤ CaissiÃ¨re B voit: Stock = 17
      â”‚ ğŸ‘¤ Client voit: Stock = 17
      â”‚
      â”‚ ğŸ‘¤ CaissiÃ¨re B: "Encaisser Marie (5)"
      â”œâ”€â–º RÃ©servation crÃ©Ã©e
      â”‚
T+2   â”‚ Stock Sandwich: 20  (toujours pas touchÃ©)
      â”‚ RÃ©servations: [Jean: 3, Marie: 5]
      â”‚ Stock affichÃ©: 12  âœ…
      â”‚
      â”‚ ğŸ‘¤ CaissiÃ¨re A: "Confirmer paiement Jean"
      â”œâ”€â–º RÃ©servation Jean supprimÃ©e
      â”œâ”€â–º TRIGGER: stock -= 3
      â”‚
T+3   â”‚ Stock Sandwich: 17  (dÃ©crÃ©mentÃ©)
      â”‚ RÃ©servations: [Marie: 5]
      â”‚ Stock affichÃ©: 12  âœ…
      â”‚
      â”‚ ğŸ‘¤ CaissiÃ¨re B: "Annuler Marie"
      â”œâ”€â–º RÃ©servation Marie supprimÃ©e
      â”‚
T+4   â”‚ Stock Sandwich: 17
      â”‚ RÃ©servations: []
      â”‚ Stock affichÃ©: 17  âœ… (Stock libÃ©rÃ© !)
```

---

## ğŸ›¡ï¸ PROTECTION CONTRE SURVENTE

```
SCÃ‰NARIO: 2 caissiÃ¨res encaissent en mÃªme temps

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stock: 10 sandwichs                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     CaissiÃ¨re A                    CaissiÃ¨re B
          â”‚                              â”‚
     T+0  â”‚  Ouvre "Jean"                â”‚
          â”‚  Voit: 10 sandwichs          â”‚
          â”‚                              â”‚  Ouvre "Marie"
          â”‚                              â”‚  Voit: 10 sandwichs
          â”‚                              â”‚
     T+1  â”‚  Encaisser 7 sandwichs       â”‚
          â”œâ”€â”€â–º RÃ©servation crÃ©Ã©e         â”‚
          â”‚    Stock affichÃ©: 3          â”‚
          â”‚                              â”‚  Encaisser 6 sandwichs
          â”‚                              â”œâ”€â”€â–º VÃ‰RIFICATION...
          â”‚                              â”‚    Stock rÃ©el = 10 - 7 = 3
          â”‚                              â”‚    DemandÃ©: 6
          â”‚                              â”‚    3 < 6 â†’ ERREUR âŒ
          â”‚                              â”‚
          â”‚                              â—„â”€â”€â”€ "Stock insuffisant"
          â”‚                              â”‚
     T+2  â”‚  Confirme paiement           â”‚
          â”œâ”€â”€â–º Stock: 10 â†’ 3             â”‚
          â”‚    RÃ©servation supprimÃ©e     â”‚
          â”‚                              â”‚  Peut maintenant
          â”‚                              â”‚  encaisser 3 âœ…
          â”‚                              â”‚
     T+3  â”‚                              â”‚  Encaisser 3 sandwichs
          â”‚                              â”œâ”€â”€â–º RÃ©servation OK
          â”‚                              â”‚    Stock affichÃ©: 0
          â”‚                              â”‚
          â”‚                              â”‚  Confirme paiement
          â”‚                              â”œâ”€â”€â–º Stock: 3 â†’ 0
          â”‚                              â”‚
     T+4  â”‚  Stock final: 0 âœ…           â”‚
          â”‚  7 + 3 = 10 (correct !)      â”‚
          â”‚  PAS DE SURVENTE âœ…          â”‚
```

---

## ğŸ“± INTERFACES UTILISATEUR

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PAGE CLIENT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Voit: stock_reel_disponible depuis v_stock_disponible      â”‚
â”‚  Effet rÃ©servation: OUI (stock diminue visuellement)        â”‚
â”‚  Peut commander si stock > 0                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PAGE CAISSE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Action "Encaisser":                                        â”‚
â”‚    â†’ POST /api/reservations/commande/:nom                   â”‚
â”‚    â†’ CrÃ©e rÃ©servation                                       â”‚
â”‚    â†’ Stock visible diminue                                  â”‚
â”‚                                                             â”‚
â”‚  Action "Confirmer":                                        â”‚
â”‚    â†’ PUT /api/commandes/:id/payer                           â”‚
â”‚    â†’ Supprime rÃ©servation                                   â”‚
â”‚    â†’ DÃ©crÃ©mente stock                                       â”‚
â”‚                                                             â”‚
â”‚  Action "Annuler":                                          â”‚
â”‚    â†’ DELETE /api/reservations/commande/:nom                 â”‚
â”‚    â†’ Supprime rÃ©servation                                   â”‚
â”‚    â†’ Stock PAS touchÃ©                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAGE PRÃ‰PARATEUR                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Voit: Commandes payÃ©es                                     â”‚
â”‚  Peut: Livrer (partiel ou complet)                          â”‚
â”‚  Stock: DÃ©jÃ  dÃ©crÃ©mentÃ© (affichage info)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PAGE ADMIN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Stats: Utilise stock_disponible (rÃ©el)                     â”‚
â”‚  Voit: Historique mouvements stock                          â”‚
â”‚  Voit: RÃ©servations actives (debug)                         â”‚
â”‚  Peut: GÃ©rer paramÃ¨tres (ouverture/fermeture)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ RÃ‰SUMÃ‰ RAPIDE

```
v2.7 = v2.6.4 + RÃ©servations Temporaires

AVANT (v2.6.4):
  Stock affichÃ© = Stock en base
  ProblÃ¨me: Survente possible si 2 caissiÃ¨res simultanÃ©es

APRÃˆS (v2.7):
  Stock affichÃ© = Stock en base - RÃ©servations
  Solution: Impossible de surv endre âœ…

NOUVEAUTÃ‰S:
  âœ… Table: reservation_temporaire
  âœ… Vue: v_stock_disponible
  âœ… Fonctions: nettoyer, supprimer
  âœ… Endpoints: POST/DELETE/GET rÃ©servations
  âœ… Protection automatique survente
  âœ… Cleanup auto 30 min
```

---

**PrÃªt pour le dÃ©ploiement ! ğŸš€**
