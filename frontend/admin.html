<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Buvette Gospel</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // V√©rifier l'acc√®s au chargement de la page
        window.addEventListener('DOMContentLoaded', async () => {
            const hasAccess = await verifierAccesAdmin();
            if (!hasAccess) {
                document.body.innerHTML = '<div style="text-align:center;padding:50px;"><h1>Acc√®s refus√©</h1><p>Redirection...</p></div>';
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <header class="header admin-header">
            <h1 id="titrePage">‚öôÔ∏è Administration - Buvette Gospel</h1>
            <div class="nav-links">
                <a href="index.html">Client</a>
                <a href="caisse.html">Caisse</a>
                <a href="preparateur.html">Pr√©parateur</a>
                <a href="admin.html" class="active">Admin</a>
                <a href="#" onclick="deconnecterAdmin(); return false;" style="color: #ef4444;">üîì D√©connexion</a>
            </div>
        </header>

        <div class="main-content">
            <!-- Contr√¥le de la vente -->
            <div class="card" style="background: linear-gradient(135deg, var(--primary-light), var(--primary)); color: white; margin-bottom: var(--spacing-lg);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="color: white; margin-bottom: var(--spacing-xs);">üõí Contr√¥le de la Vente</h2>
                        <p id="venteStatus" style="font-size: 1.1rem; opacity: 0.9;">Chargement...</p>
                    </div>
                    <button id="btnToggleVente" onclick="toggleVente()" class="btn-primary" style="background: white; color: var(--primary); font-size: 1.1rem; padding: var(--spacing-md) var(--spacing-lg); min-width: 200px;">
                        Chargement...
                    </button>
                </div>
            </div>

            <!-- Statistiques globales -->
            <div class="card">
                <h2>üìä Vue d'ensemble</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-value" id="statsAttente">0</div>
                        <div class="stat-label">En attente</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí≥</div>
                        <div class="stat-value" id="statsPayees">0</div>
                        <div class="stat-label">Pay√©es</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-value" id="statsPartielles">0</div>
                        <div class="stat-label">Livr√©es partiellement</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úì</div>
                        <div class="stat-value" id="statsLivrees">0</div>
                        <div class="stat-label">Livr√©es</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-value" id="statsCA">0‚Ç¨</div>
                        <div class="stat-label">Chiffre d'affaires</div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0; font-size: 0.85em;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>üí≥ CB:</span>
                                <strong id="statsCB">0‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>üíµ Esp√®ces:</span>
                                <strong id="statsEspeces">0‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>üìù Ch√®que:</span>
                                <strong id="statsCheque">0‚Ç¨</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gestion du stock -->
            <div class="card">
                <div class="card-header">
                    <h2>üì¶ Gestion du stock</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="toggleAffichageStock()" class="btn btn-secondary btn-sm" id="btnToggleStock">
                            üëÅÔ∏è Afficher tous les articles
                        </button>
                        <button onclick="chargerStock()" class="btn btn-secondary btn-sm">üîÑ Actualiser</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Article</th>
                                <th>Prix</th>
                                <th>Stock actuel</th>
                                <th>Vendus</th>
                                <th>CA</th>
                                <th>Actif</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stockTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Statistiques par article -->
            <div class="card">
                <div class="card-header">
                    <h2>üìà Statistiques de vente par article</h2>
                    <button onclick="toggleAffichageStatsArticles()" class="btn btn-secondary btn-sm" id="btnToggleStatsArticles">
                        üëÅÔ∏è Afficher tous les articles
                    </button>
                </div>
                <div id="statsArticles" class="stats-articles"></div>
            </div>

            <!-- Historique des ventes -->
            <div class="card">
                <h2>üßæ Historique des ventes</h2>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Commande</th>
                                <th>Statut</th>
                                <th>Articles</th>
                                <th>Quantit√©</th>
                                <th>Montant</th>
                                <th>Pay√©e le</th>
                                <th>Livr√©e le</th>
                            </tr>
                        </thead>
                        <tbody id="historiqueTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de modification de stock -->
    <div id="modalStock" class="modal">
        <div class="modal-content">
            <h2>üì¶ Modifier le stock</h2>
            <div id="modalBody">
                <div class="form-group">
                    <label>Article:</label>
                    <p id="articleNom" class="form-value"></p>
                </div>
                <div class="form-group">
                    <label>Stock actuel:</label>
                    <p id="stockActuel" class="form-value"></p>
                </div>
                <div class="form-group">
                    <label for="nouveauStock">Nouveau stock:</label>
                    <input type="number" id="nouveauStock" min="0" class="input-large">
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="articleActif" style="margin-right: 10px;">
                        <span>Article actif (visible aux clients)</span>
                    </label>
                </div>
                <div class="form-group">
                    <label for="commentaire">Commentaire (optionnel):</label>
                    <textarea id="commentaire" class="input-large" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button onclick="fermerModal()" class="btn btn-secondary">Annuler</button>
                <button onclick="confirmerModifStock()" class="btn btn-success">‚úì Enregistrer</button>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/config.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
